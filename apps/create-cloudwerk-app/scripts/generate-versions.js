#!/usr/bin/env node
/**
 * Generate versions.ts from workspace package.json files
 *
 * This script reads the versions from @cloudwerk/core and @cloudwerk/cli
 * and writes them to src/versions.ts so they're embedded at build time.
 */

import { readFileSync, writeFileSync } from 'node:fs'
import { dirname, join } from 'node:path'
import { fileURLToPath } from 'node:url'

const __dirname = dirname(fileURLToPath(import.meta.url))
const rootDir = join(__dirname, '..', '..', '..')

// Read versions from workspace packages
const corePackage = JSON.parse(
  readFileSync(join(rootDir, 'packages/core/package.json'), 'utf-8')
)
const cliPackage = JSON.parse(
  readFileSync(join(rootDir, 'packages/cli/package.json'), 'utf-8')
)

const versionsContent = `/**
 * Auto-generated file - DO NOT EDIT
 * Generated by scripts/generate-versions.js
 */

export const CORE_VERSION = '${corePackage.version}'
export const CLI_VERSION = '${cliPackage.version}'
`

const outputPath = join(__dirname, '..', 'src', 'versions.ts')
writeFileSync(outputPath, versionsContent)

console.log(`Generated versions.ts: core=${corePackage.version}, cli=${cliPackage.version}`)
